---
import Layout from "../../layouts/Layout.astro";
import Person from '../../components/Person.astro';
import {sortedPeople} from "../../Person";

const hygraph_endpoint = await import.meta.env.HYGRAPH_ENDPOINT;
const pageSize = 300;
const response = await fetch(
    hygraph_endpoint,
    {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            Accept: "application/json",
        },
        body: JSON.stringify({
            query: `
query AllPeople($size: Int) {
  people(first: $size, orderBy: fullName_ASC) {
    nickname
    fullName
    email
    bio
    avatar {
      id
      url
      fileName
    }
    starred(first: 500, orderBy: airedAt_DESC) {
      entryId: id
      code
      name
      airedAt
    },
    hosted(first: 500, orderBy: airedAt_DESC) {
      entryId: id
      code
      name
      airedAt
    },
    cohosted(first: 500, orderBy: airedAt_DESC) {
      entryId: id
      code
      name
      airedAt
    },
    produced(first: 500, orderBy: airedAt_DESC) {
      entryId: id
      code
      name
      airedAt
    }
  }
}      
        `,
            variables: {size: pageSize}
        }),
    }
);

const data = await response.json();
const {people} = data.data;
---
<Layout title="Ljudje">
    <h1>Ljudje</h1>
    <p>Ogrodje smo <strong>ljudje</strong>.</p>
    <div class="people">
        {sortedPeople(people).map((person) =>
                <Person person={person}></Person>)}
    </div>
</Layout>
<style lang="scss">
    .people {
        position: relative;
        width: 100%;
        columns: 2;
        clear: both;
        float: none;
    }

    @media only screen and (max-width: 1000px) {
        .people { columns: 1 }
    }
</style>
