---
import {type Episode, episodePath, optimiseEpisodeTitle} from "../model/Episode";
import EpizodeTools from "./EpizodeTools.astro";
import {Image} from '@unpic/vue';

interface Props {
  episode: Episode
  showTools?: boolean,
  showPreThumbnail?: boolean,
  index?: number
}

const {episode, showTools, showPreThumbnail, index} = Astro.props
const rowStyle = (episode: Episode) => {
  return [
    'episode',
    showPreThumbnail ? 'with-thumbnail' : '',
    showTools ? 'with-tools' : ''
  ].filter((v) => v != '').join(" ")
}
---
<div class={rowStyle(episode)} data-n={index !== undefined ? index : ''}>
  {showPreThumbnail && episode.thumbnail?.url && (
    <div class="thumbnail">
      <a href={'/epizode/' + episodePath(episode)}>
        <Image src={episode.thumbnail.url}
               title={episode.name}
               fallback="netlify"
               alt={episode.name} width={1920} height={1080}/>
      </a>
    </div>
  )}

  <div class="episode-wrap">
    <a href={'/epizode/' + episodePath(episode)}>
      <div class="code">{episode.code}</div>
      {episode.show && (
        <div class="show" data-show={episode.show.name}>{episode.show.name}</div>)
      }
      <div class="name">{optimiseEpisodeTitle(episode)}</div>
    </a>

    {showTools && (
      <EpizodeTools episode={episode}/>)}
  </div>

</div>
<style lang="scss">
  @use "../_variables";
  @use "../episode_row";

  .thumbnail {
    margin-bottom: 5px;
  }

  .episode {
    padding-left: 15px;
    padding-right: 15px;
  }

  .episode.with-thumbnail {
    position: relative;
    padding-left: 0;
    padding-right: 0;
    margin-bottom: 0;
    padding-bottom: 0;

    .episode-wrap {
      z-index: auto;
      position: absolute;
      bottom: 7px;
      left: 0;
      right: 0;
      padding: 10px 15px 10px;

      background-color: rgba(251, 251, 251, 0.15);

      a {
        color: white !important;
      }
    }
  }
</style>
